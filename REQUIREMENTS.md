# OpenCode 配置切换器（GUI）需求说明

## 目标
- 面向 OpenCode / Oh-My-OpenCode 的多模型配置管理。
- 支持在多个 JSON 配置文件中只切换“被选中的字段/块”，而不是整文件替换。
- 通过 GUI 进行版本管理和应用。

## 核心行为
1. 用户选择配置文件。
2. 左侧管理版本，右侧通过 Diff 展示当前生效与版本内容。
3. 保存版本时，只保存局部差异（patch）。
4. 应用版本时，仅替换对应路径，不覆盖整文件。

## 重要约束
- 只保存选中的字段/块，不保存整文件快照。
- 用户可以随时修改源文件的非选中部分。
- 版本以 JSON Pointer 路径作为绑定，不依赖行号。
- 不支持 YAML。

## 交互要求
- 双栏布局：
  - 左：文件与版本管理
  - 右：Diff 编辑器（左=当前生效，右=当前版本）
- 左侧可编辑，右侧用于版本对比与保存。

## 版本管理
- 一个文件可有多个版本。
- 一个版本可包含多个路径。
- 版本名称为文本输入。

## 存储
- 使用 JSONL 存储配置（`profiles.jsonl`）。
- 每行记录一个 patch：
  - `file` 配置文件路径
  - `profile` 版本名称
  - `path` JSON Pointer
  - `value` 原始 JSON 文本
- 存储位置：Electron `app.getPath('userData')/profiles.jsonl`。

## 数据流图
```
┌─────────────┐          ┌──────────────┐         ┌───────────────────┐
│   用户操作   │ ───────▶ │   渲染进程UI   │ ─────▶ │  主进程(IPC/File)  │
└─────────────┘          └──────────────┘         └───────────────────┘
       │                          │                         │
       │                          │                         │
       │                          │                         ▼
       │                          │                ┌─────────────────┐
       │                          │                │ profiles.jsonl  │
       │                          │                └─────────────────┘
       │                          │
       │                          ▼
       │               ┌───────────────────┐
       │               │   DiffEditor 状态  │
       │               │ left=源文件        │
       │               │ right=版本内容     │
       │               └───────────────────┘
       │                          │
       │                          │
       ▼                          ▼
┌─────────────┐          ┌───────────────────────────┐
│  磁盘配置文件 │ ◀─────── │  apply/save 操作          │
└─────────────┘          │  - 应用：写入源文件        │
                         │  - 保存：写入 profiles.jsonl │
                         └───────────────────────────┘
```

## 时序图
```
用户           渲染进程(UI)          主进程(IPC)           磁盘/JSONL
 |                 |                     |                    |
 | 选择配置文件     |                     |                    |
 |---------------->| openFile对话框       |                    |
 |                 |-------------------->| 读取文件            |
 |                 |                     |------------------->| 读取源文件
 |                 |<--------------------| 返回内容            |
 |                 | 渲染Diff(左/右)      |                    |
 |                 |                     |                    |
 | 点击版本         |                     |                    |
 |---------------->| 计算版本内容         |                    |
 |                 | 更新右侧diff          |                    |
 |                 |                     |                    |
 | 右侧修改         |                     |                    |
 |---------------->| 标记待保存           |                    |
 |                 | 显示保存按钮         |                    |
 |                 |                     |                    |
 | 点击保存版本     |                     |                    |
 |---------------->| 生成patch记录        |                    |
 |                 |-------------------->| 写入JSONL           |
 |                 |                     |------------------->| profiles.jsonl
 |                 |<--------------------| 保存成功            |
 |                 | 隐藏保存按钮         |                    |
 |                 |                     |                    |
 | 点击应用         |                     |                    |
 |---------------->| 计算应用内容         |                    |
 |                 |-------------------->| 写入源文件          |
 |                 |                     |------------------->| config.json
 |                 |<--------------------| 应用成功            |
 |                 | 更新左侧diff          |                    |
```

## 导入 / 导出
- 导出：保存为 `.jsonl` 文件。
- 导入：读取 `.jsonl`，覆盖当前记录。

## 平台与技术
- 跨平台：Windows / macOS
- 技术栈：Electron + React + TypeScript
- 编辑器：Monaco Editor
- JSON 解析：jsonc-parser
